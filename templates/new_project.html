<!DOCTYPE html>
<html>
<head>
    <title>New Project</title>
    <style>
        body {
            font-family: Arial;
            margin: 20px;
            background-color: #f8f9fa;
        }
        h2 {
            margin-bottom: 10px;
        }
        input, select, textarea, button {
            margin: 5px 0;
            padding: 6px;
            width: 100%;
        }
        .form-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 0 10px #ccc;
            margin-bottom: 20px;
        }
        .button-group {
            text-align: right;
            margin-top: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 25px;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 8px;
        }
        th {
            background-color: #e9ecef;
        }
        .actions button {
            margin-right: 5px;
        }
        .signatures div {
            margin: 10px 0;
        }
        .dropdown {
            position: relative;
        }
        .dropdown-search {
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            max-height: 150px;
            overflow-y: auto;
            width: 100%;
            z-index: 100;
        }
        .dropdown-search div {
            padding: 6px;
            cursor: pointer;
        }
        .dropdown-search div:hover {
            background: #f1f1f1;
        }
    </style>
</head>
<body>

    <h2>New Project</h2>

    <form method="post">
        <div class="form-section">
            <div>
                <label>Enquiry ID</label>
                <input type="text" name="enquiry_id" value="VE/TN/2526/E001" readonly>

                <label>Quotation</label>
                <input type="text" name="quotation">

                <label>Start Date</label>
                <input type="date" name="start_date">

                <label>End Date</label>
                <input type="date" name="end_date">

                <label>Project Location</label>
                <input type="text" name="project_location">

                <label>Source Drawing</label>
                <input type="file" name="drawing">
            </div>
            <div>
                <label>Vendor Name</label>
                <div class="dropdown">
                    <input type="text" id="vendorSearch" onkeyup="filterVendors()" placeholder="Search vendors...">
                    <div id="vendorDropdown" class="dropdown-search"></div>
                </div>

                <label>GST No</label>
                <input type="text" id="gst_no" readonly>

                <label>Address</label>
                <textarea id="vendor_address" rows="3" readonly></textarea>

                <label>Email</label>
                <input type="email" name="email">

                <label>Contact Number</label>
                <input type="text" name="contact">

                <label>Project Incharge</label>
                <input type="text" name="incharge">

                <label>Notes</label>
                <textarea name="notes" rows="2"></textarea>
            </div>
        </div>

        <div class="button-group">
            <button type="submit">Save</button>
            <button type="reset">Cancel</button>
            <a href="/dashboard"><button type="button">Back</button></a>
        </div>
    </form>

    <h3>Projects Table</h3>
    <table id="projectsTable">
        <thead>
            <tr>
                <th>Enquiry ID</th>
                <th>Quotation</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Location</th>
                <th>Incharge</th>
                <th>Contact</th>
                <th>Email</th>
                <th>Notes</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="projectBody">
            <!-- Example dummy row -->
            <tr>
                <td contenteditable="false">VE/TN/2526/E001</td>
                <td contenteditable="true">Q-001</td>
                <td contenteditable="true">2025-08-01</td>
                <td contenteditable="true">2025-08-20</td>
                <td contenteditable="true">Chennai</td>
                <td contenteditable="true">Ravi</td>
                <td contenteditable="true">9876543210</td>
                <td contenteditable="true">ravi@xyz.com</td>
                <td contenteditable="true">Urgent delivery</td>
                <td class="actions">
                    <button onclick="saveRow(this)">Save</button>
                    <button onclick="deleteRow(this)">Delete</button>
                    <button onclick="alert('Add Measurement Sheet clicked')">Add Sheet</button>
                </td>
            </tr>
        </tbody>
    </table>

    <div class="button-group">
        <button onclick="alert('Export to PDF')">Export PDF</button>
        <button onclick="alert('Export to Excel')">Export Excel</button>
        <button onclick="alert('Data submitted')">Submit</button>
        <button onclick="window.print()">Print</button>
    </div>

    <h3>Approvals</h3>
    <div class="signatures">
        <div><button onclick="fillApproval('prepared')">Prepared By</button> <span id="prepared"></span></div>
        <div><button onclick="fillApproval('checked')">Checked By</button> <span id="checked"></span></div>
        <div><button onclick="fillApproval('approved')">Approved By</button> <span id="approved"></span></div>
    </div>

    <script>
        const vendors = {{ vendors | tojson }};

        function filterVendors() {
            const input = document.getElementById("vendorSearch");
            const filter = input.value.toLowerCase();
            const dropdown = document.getElementById("vendorDropdown");
            dropdown.innerHTML = '';
            vendors.forEach(v => {
                if (v.name.toLowerCase().includes(filter)) {
                    const div = document.createElement("div");
                    div.textContent = v.name;
                    div.onclick = () => {
                        input.value = v.name;
                        document.getElementById("gst_no").value = v.gst;
                        document.getElementById("vendor_address").value = v.address;
                        dropdown.innerHTML = '';
                    };
                    dropdown.appendChild(div);
                }
            });
        }

        function saveRow(btn) {
            alert("Row saved");
        }

        function deleteRow(btn) {
            if (confirm("Are you sure you want to delete this row?")) {
                const row = btn.closest("tr");
                row.remove();
            }
        }

        function fillApproval(type) {
            const now = new Date().toLocaleString();
            let role = '';
            if (type === 'prepared') role = 'Prepared by Design Engineer';
            if (type === 'checked') role = 'Checked by Project Manager';
            if (type === 'approved') role = 'Approved by MD';
            document.getElementById(type).textContent = `${role} on ${now}`;
        }
    </script>
</body>
</html>
